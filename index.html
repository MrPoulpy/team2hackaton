<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Chess</title>
		<link rel="stylesheet" href="css/chessboard-0.3.0.css" />
		<link rel="stylesheet" href="css/main.css" />

		<script src="js/chess.js"></script>
		<script src="js/json3.min.js"></script>
		<script src="js/jquery-1.10.1.min.js"></script>
		<script src="js/chessboard-0.3.0.js"></script>
	</head>
	<body>
		<div id="board" style="width: 400px"></div>
		
<input type="button" id="ruyLopezBtn" value="Ruy Lopez" />
	</body>
	<script>

var init = function() {

	var board;
	var boardEl = $('#board');
	var game = new Chess();
	var squareToHighlight;

	var removeHighlights = function(color) {
		boardEl.find('.square-55d63').removeClass('highlight-' + color);
	};

	var onDragStart = function(source, piece, position, orientation) {
		if (game.in_checkmate() === true || game.in_draw() === true || piece.search(/^b/) !== -1) {
			return (false);
		}
	};

	var makeRandomMove = function() {
		var possibleMoves = game.moves({
			verbose: true
		});

		// game over
		if (possibleMoves.length === 0) {
			console.log("win");
			return;
		}

		var randomIndex = Math.floor(Math.random() * possibleMoves.length);
		var move = possibleMoves[randomIndex];
		game.move(move.san);

		// highlight black's move
		removeHighlights('black');
		boardEl.find('.square-' + move.from).addClass('highlight-black');
		squareToHighlight = move.to;

		// update the board to the new position
		board.position(game.fen());
	};

	var onDrop = function(source, target) {
		// see if the move is legal
		var move = game.move({
			from: source,
			to: target,
			promotion: 'q' // NOTE: always promote to a queen for example simplicity
		});

		// illegal move
		if (move === null) return 'snapback';

		// highlight white's move
		removeHighlights('white');
		boardEl.find('.square-' + source).addClass('highlight-white');
		boardEl.find('.square-' + target).addClass('highlight-white');

		// make random move for black
		window.setTimeout(makeRandomMove, 250);
	};

	var onMoveEnd = function() {
		boardEl.find('.square-' + squareToHighlight).addClass('highlight-black');
	};

	// update the board position after the piece snap
	// for castling, en passant, pawn promotion
	var onSnapEnd = function() {
		board.position(game.fen());
	};

	var cfg = {
		draggable: true,
		position: '2k5/8/8/8/8/8/8/QQQ5',
		//		position: 'r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R',
		onDragStart: onDragStart,
		onDrop: onDrop,
		onMoveEnd: onMoveEnd,
		onSnapEnd: onSnapEnd
	};
	
	board = new ChessBoard('board', cfg);
	console.log(game.load(cfg.position+' w - - 0 1'));
};

$(document).ready(init);
	</script>
</html>